<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Different Ways to Initialize Go structs | Anton Sankov's Blog</title>
<meta name=description content="In this article, we'll take a look at what options Go is giving us to initialize our structs, what are their limitations and how to overcome them."><meta property="og:url" content="https://asankov.dev/blog/2022/01/29/different-ways-to-initialize-go-structs/"><meta property="og:site_name" content="Anton Sankov's Blog"><meta property="og:title" content="Different Ways to Initialize Go structs"><meta property="og:description" content="In this article, we'll take a look at what options Go is giving us to initialize our structs, what are their limitations and how to overcome them."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-19T09:45:31+02:00"><meta itemprop=name content="Different Ways to Initialize Go structs"><meta itemprop=description content="In this article, we'll take a look at what options Go is giving us to initialize our structs, what are their limitations and how to overcome them."><meta itemprop=datePublished content="2022-01-29T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-19T09:45:31+02:00"><meta itemprop=wordCount content="1602"><meta itemprop=keywords content="Go"><meta name=twitter:card content="summary"><meta name=twitter:title content="Different Ways to Initialize Go structs"><meta name=twitter:description content="In this article, we'll take a look at what options Go is giving us to initialize our structs, what are their limitations and how to overcome them."><link rel=preload href=/scss/main.min.7afdf8df464bda87b7202cb1259549e2a2b0fd4c5c55c9f15f73426c5b305b15.css as=style integrity="sha256-ev3430ZL2oe3ICyxJZVJ4qKw/UxcVcnxX3NCbFswWxU=" crossorigin=anonymous><link href=/scss/main.min.7afdf8df464bda87b7202cb1259549e2a2b0fd4c5c55c9f15f73426c5b305b15.css rel=stylesheet integrity="sha256-ev3430ZL2oe3ICyxJZVJ4qKw/UxcVcnxX3NCbFswWxU=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-7Y9WXX1393"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7Y9WXX1393")}</script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Anton Sankov's Blog</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/cv/><span>CV</span></a></li><li class=nav-item><a class=nav-link href=/about/><span>About Me</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="Anton Sankov's Blog" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog2023011390daysofdevops-continuous-build-integration-and-testing-li><a href=/blog/2023/01/13/90daysofdevops-continuous-build-integration-and-testing/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog2023011390daysofdevops-continuous-build-integration-and-testing><span>90DaysOfDevOps - Continuous Build, Integration and Testing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20221222implementing-the-java-stream-api-with-go-generics-part-1-li><a href=/blog/2022/12/22/implementing-the-java-stream-api-with-go-generics-part-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20221222implementing-the-java-stream-api-with-go-generics-part-1><span>Implementing the Java Stream API with Go Generics: Part 1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220711demystifying-the-kubernetes-iceberg-part-8-li><a href=/blog/2022/07/11/demystifying-the-kubernetes-iceberg-part-8/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220711demystifying-the-kubernetes-iceberg-part-8><span>Demystifying the Kubernetes Iceberg: Part 8</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220704demystifying-the-kubernetes-iceberg-part-7-li><a href=/blog/2022/07/04/demystifying-the-kubernetes-iceberg-part-7/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220704demystifying-the-kubernetes-iceberg-part-7><span>Demystifying the Kubernetes Iceberg: Part 7</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220627demystifying-the-kubernetes-iceberg-part-6-li><a href=/blog/2022/06/27/demystifying-the-kubernetes-iceberg-part-6/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220627demystifying-the-kubernetes-iceberg-part-6><span>Demystifying the Kubernetes Iceberg: Part 6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220612demystifying-the-kubernetes-iceberg-part-5-li><a href=/blog/2022/06/12/demystifying-the-kubernetes-iceberg-part-5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220612demystifying-the-kubernetes-iceberg-part-5><span>Demystifying the Kubernetes Iceberg: Part 5</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220605demystifying-the-kubernetes-iceberg-part-4-li><a href=/blog/2022/06/05/demystifying-the-kubernetes-iceberg-part-4/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220605demystifying-the-kubernetes-iceberg-part-4><span>Demystifying the Kubernetes Iceberg: Part 4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220529demystifying-the-kubernetes-iceberg-part-3-li><a href=/blog/2022/05/29/demystifying-the-kubernetes-iceberg-part-3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220529demystifying-the-kubernetes-iceberg-part-3><span>Demystifying the Kubernetes Iceberg: Part 3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220522demystifying-the-kubernetes-iceberg-part-2-li><a href=/blog/2022/05/22/demystifying-the-kubernetes-iceberg-part-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220522demystifying-the-kubernetes-iceberg-part-2><span>Demystifying the Kubernetes Iceberg: Part 2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220515demystifying-the-kubernetes-iceberg-part-1-li><a href=/blog/2022/05/15/demystifying-the-kubernetes-iceberg-part-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220515demystifying-the-kubernetes-iceberg-part-1><span>Demystifying the Kubernetes Iceberg: Part 1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220421securing-kubernetes-with-open-policy-agent-li><a href=/blog/2022/04/21/securing-kubernetes-with-open-policy-agent/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220421securing-kubernetes-with-open-policy-agent><span>Securing Kubernetes with Open Policy Agent</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20220129different-ways-to-initialize-go-structs-li><a href=/blog/2022/01/29/different-ways-to-initialize-go-structs/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20220129different-ways-to-initialize-go-structs><span class=td-sidebar-nav-active-item>Different Ways to Initialize Go structs</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#build-in-options>Build-in options</a></li><li><a href=#constructor-function>Constructor function</a><ul><li><a href=#with-positional-arguments>With positional arguments</a></li><li><a href=#with-options-struct>With Options struct</a></li><li><a href=#variadic-function-constructor>Variadic function constructor</a></li><li><a href=#middle-ground>Middle ground</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#takeaways>Takeaways</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://asankov.dev/categories/devops/ data-taxonomy-term=devops><span class=taxonomy-label>DevOps</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://asankov.dev/categories/gatekeeper/ data-taxonomy-term=gatekeeper><span class=taxonomy-label>Gatekeeper</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://asankov.dev/categories/go/ data-taxonomy-term=go><span class=taxonomy-label>Go</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://asankov.dev/categories/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=https://asankov.dev/categories/open-policy-agent/ data-taxonomy-term=open-policy-agent><span class=taxonomy-label>Open Policy Agent</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://asankov.dev/categories/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>2</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><h1>Different Ways to Initialize Go structs</h1><div class=lead>In this article, we&rsquo;ll take a look at what options Go is giving us to initialize our structs, what are their limitations and how to overcome them.</div><div class="td-byline mb-4"><time datetime=2022-01-29 class=text-body-secondary>Saturday, January 29, 2022</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://asankov.dev/categories/go/ data-taxonomy-term=go><span class=taxonomy-label>Go</span></a></li></ul></div><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 8 minute read &nbsp;</p></header><p>Many languages like Java, C#, etc. have <code>constructors</code> that help you instantiate an object and its properties.</p><p>Go does not have ‘constructors’ in the pure sense of the word.
Let&rsquo;s see what Go has instead.</p><h2 id=build-in-options>Build-in options</h2><p>Out-of-the-box Go gives us 2 ways to initialize structs - struct literals and the <code>new</code> build-in function.
Let’s see what these look like for a simple struct named <code>Person</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> Person <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  age  <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>  name <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// struct literal
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Person{
</span></span><span style=display:flex><span>  age:  <span style=color:#2aa198>25</span>,
</span></span><span style=display:flex><span>  name: <span style=color:#2aa198>&#34;Anton&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// new build-in
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person <span style=color:#719e07>:=</span> <span style=color:#b58900>new</span>(Person) <span style=color:#586e75>// person is of type *Person
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person.age = <span style=color:#2aa198>25</span>
</span></span><span style=display:flex><span>person.name = <span style=color:#2aa198>&#34;Anton&#34;</span>
</span></span></code></pre></div><p>However, in this scenario the <code>Person</code> fields are un-exported, thus they cannot be used outside of the <code>people</code> package. We can easily mitigate this by exporting them:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#586e75>// people/person.go
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> Person <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  Name <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>  Age  <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// main.go
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> <span style=color:#2aa198>&#34;asankov.dev/people&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// struct literal
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>people.Person{
</span></span><span style=display:flex><span>  Name: <span style=color:#2aa198>&#34;Anton&#34;</span>,
</span></span><span style=display:flex><span>  Age:  <span style=color:#2aa198>25</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// new build-in
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person <span style=color:#719e07>:=</span> <span style=color:#b58900>new</span>(people.Person) <span style=color:#586e75>// p is of type *people.Person
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>person.Name = <span style=color:#2aa198>&#34;Anton&#34;</span>
</span></span><span style=display:flex><span>person.Age = <span style=color:#2aa198>25</span>
</span></span></code></pre></div><p>But both of these options contain a big trade-off - now all the fields of the person can be viewed and changed by anyone.
Also, we have no validation.
For example, in this scenario, we can easily set the <code>Age</code> property to a negative value.</p><p>So what can we do if we don’t want to export the fields or enforce additional validation?</p><h2 id=constructor-function>Constructor function</h2><p>As I said in the beginning, Go does not have constructors.
However, that does not mean we cannot define one ourselves.
Let’s see how a user-defined constructor can look like:</p><h3 id=with-positional-arguments>With positional arguments</h3><p>We can define a constructor function where the struct fields are positional arguments of the function:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(name <span style=color:#dc322f>string</span>, age <span style=color:#dc322f>int</span>) <span style=color:#719e07>*</span>Person {
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> age &lt; <span style=color:#2aa198>0</span> {
</span></span><span style=display:flex><span>    <span style=color:#b58900>panic</span>(<span style=color:#2aa198>&#34;NewPerson: age cannot be a negative number&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{name: name, age: age}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This provides us 2 benefits:</p><ol><li>We have validation for the <code>age</code> field. If someone tried to create a <code>Person</code> with a negative age, they will get a panic with a descriptive error of what they did wrong (we could have also returned an error, but this does not matter for the topic at hand). In the same manner, we could add validation for the <code>name</code> field (for example, that it’s not empty).</li><li>The <code>Person</code> internals are decoupled from the initialization logic. For example, we can add an <code>isUnderage</code> field to the struct and compute that based on <code>age</code> inside of the <code>NewPerson</code> function. The consumer of the function won’t have to be bothered with the logic behind this field, because we are taking care of it.</li></ol><p>But it also has some downsides. If our <code>Person</code> had many <code>string</code> fields (for example - multiple names or addresses) this function would have looked like that:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(firstName, lastName, addressLine1, addressLine2 <span style=color:#dc322f>string</span>, age <span style=color:#dc322f>int</span>) <span style=color:#719e07>*</span>Person
</span></span></code></pre></div><p>and having a function with multiple parameters of the same type is a recipe for disaster.
In this case, the danger is that the consumer of this function can easily misplace any of the parameters (for example, replace the first and last names) and they would have no compile-time check for that.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#586e75>// is it?
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>p <span style=color:#719e07>:=</span> <span style=color:#268bd2>NewPerson</span>(<span style=color:#2aa198>&#34;Anton&#34;</span>, <span style=color:#2aa198>&#34;Sankov&#34;</span>, <span style=color:#2aa198>&#34;Bulgaria&#34;</span>, <span style=color:#2aa198>&#34;Sofia&#34;</span>, <span style=color:#2aa198>25</span>)
</span></span><span style=display:flex><span><span style=color:#586e75>// or?
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>p <span style=color:#719e07>:=</span> <span style=color:#268bd2>NewPerson</span>(<span style=color:#2aa198>&#34;Anton&#34;</span>, <span style=color:#2aa198>&#34;Sankov&#34;</span>, <span style=color:#2aa198>&#34;Sofia&#34;</span>, <span style=color:#2aa198>&#34;Bulgaria&#34;</span>, <span style=color:#2aa198>25</span>)
</span></span><span style=display:flex><span><span style=color:#586e75>// or?
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>p <span style=color:#719e07>:=</span> <span style=color:#268bd2>NewPerson</span>(<span style=color:#2aa198>&#34;Anton&#34;</span>, <span style=color:#2aa198>&#34;Bulgaria&#34;</span>, <span style=color:#2aa198>&#34;Sofia&#34;</span>, <span style=color:#2aa198>&#34;Sofia str, number 25&#34;</span>, <span style=color:#2aa198>25</span>)
</span></span></code></pre></div><p>Another, even bigger issue than that is backward compatibility.
Let’s say that we need to add additional fields to our <code>Person</code> struct. For example, <code>salary</code> (money rules the world, don’t they).
We can easily add it:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> Person <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  age    <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>  name   <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>  salary <span style=color:#dc322f>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// change
</span></span></span><span style=display:flex><span><span style=color:#586e75>// func NewPerson(name string, age int) *Person {
</span></span></span><span style=display:flex><span><span style=color:#586e75>// to:
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(name <span style=color:#dc322f>string</span>, age <span style=color:#dc322f>int</span>, salary <span style=color:#dc322f>float64</span>) <span style=color:#719e07>*</span>Person {
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> age &lt; <span style=color:#2aa198>0</span> <span style=color:#719e07>||</span> salary &lt; <span style=color:#2aa198>0</span> {
</span></span><span style=display:flex><span>    <span style=color:#b58900>panic</span>(<span style=color:#2aa198>&#34;NewPerson: age and salary cannot be negative numbers&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{name: name, age: age, salary: salary}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>However, this is a breaking change to the <code>NewPerson</code> method. If this were a library, all of the consumers would get compilation errors when they upgrade to the new version. This is definitely not ideal and could have a side-effect of your consumers screaming at you on Twitter.</p><p>Is there a way to make this without breaking change?
Yes, of course.
To do this we need to restructure our <code>NewPerson</code> function.
Let’s see what are our options.</p><h3 id=with-options-struct>With Options struct</h3><p>We can define <code>PersonOptions</code> struct that mirrors the <code>Person</code> but with exported field and pass this to <code>NewPerson</code>.
Let’s see how this looks like:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> Person <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  age    <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>  name   <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>  salary <span style=color:#dc322f>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> PersonOptions <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  Age    <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>  Name   <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>  Salary <span style=color:#dc322f>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(opts <span style=color:#719e07>*</span>PersonOptions) <span style=color:#719e07>*</span>Person {
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> opts <span style=color:#719e07>==</span> <span style=color:#cb4b16>nil</span> <span style=color:#719e07>||</span> opts.Age &lt; <span style=color:#2aa198>0</span> <span style=color:#719e07>||</span> opts.Salary &lt; <span style=color:#2aa198>0</span> {
</span></span><span style=display:flex><span>    <span style=color:#b58900>panic</span>(<span style=color:#2aa198>&#34;NewPerson: age and salary cannot be negative numbers&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{name: opts.Name, age: opts.Age, salary: opts.Salary}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This allows us to introduce new fields to <code>Person</code> as much as we like without breaking the contract of <code>NewPerson</code>.</p><p>However, there is another trade-off here: If we add a new field to <code>Person</code>(and respectively <code>PersonOptions</code>) we cannot easily enforce that all consumers of <code>NewPerson</code> will set the new properties.</p><p>Of course, we can fail <code>NewPerson</code> if any of the new fields are missing, but this is actually a breaking change, not much better than the one in the first example (and even worse, because it will only be caught at runtime).</p><p>Another downside here is that it&rsquo;s not obvious which fields from the <code>PersonOptions</code> structs are required and which are optional.
The clearest way to communicate this to the consumers is via docstrings, which is not as obvious as just looking at the method signature (because who reads the docs, right).</p><p>Possible mitigation to this problem is if we define the required field in <code>PersonOptions</code> as value types and the optional ones as refs.
For example:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#268bd2>type</span> PersonOptions <span style=color:#268bd2>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#586e75>// Age and Name are required
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>  Age    <span style=color:#dc322f>int</span>
</span></span><span style=display:flex><span>  Name   <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#586e75>// Salary is optional
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>  Salary <span style=color:#719e07>*</span><span style=color:#dc322f>float64</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This way the consumer can set the optional fields to <code>nil</code> and not bother with default values.
It is also a bit more clear what is required and what is not.</p><h3 id=variadic-function-constructor>Variadic function constructor</h3><p>Alternative to that is to make our constructor a variadic function that accepts an arbitrary number of mutating functions.
Then, the implementation of the method will run all the functions one by one on an instance of the struct which will be returned by the constructor.
This means, we also need to provide a set of functions that will mutate the fields.</p><p>If you did not understand anything from this explanation, don’t worry.
Here’s how the code looks like:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> people
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>type</span> PersonOptionFunc <span style=color:#268bd2>func</span>(<span style=color:#719e07>*</span>Person)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>WithName</span>(name <span style=color:#dc322f>string</span>) PersonOptionFunc {
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#268bd2>func</span>(p <span style=color:#719e07>*</span>Person) {
</span></span><span style=display:flex><span>    p.name = name
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>WithAge</span>(age <span style=color:#dc322f>int</span>) PersonOptionFunc {
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#268bd2>func</span>(p <span style=color:#719e07>*</span>Person) {
</span></span><span style=display:flex><span>    p.age = age
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(opts <span style=color:#719e07>...</span>PersonOptionFunc) <span style=color:#719e07>*</span>Person {
</span></span><span style=display:flex><span>  p <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Person{}
</span></span><span style=display:flex><span>  <span style=color:#719e07>for</span> _, opt <span style=color:#719e07>:=</span> <span style=color:#719e07>range</span> opts {
</span></span><span style=display:flex><span>    <span style=color:#268bd2>opt</span>(p)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> p
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// usage:
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>p <span style=color:#719e07>:=</span> people.<span style=color:#268bd2>NewPerson</span>(people.<span style=color:#268bd2>WithName</span>(<span style=color:#2aa198>&#34;Anton&#34;</span>), people.<span style=color:#268bd2>WithAge</span>(<span style=color:#2aa198>25</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fmt.<span style=color:#268bd2>Println</span>(p) <span style=color:#586e75>// {name: &#34;Anton&#34;, age: 25}
</span></span></span></code></pre></div><p>The downside here is that the amount of <code>WithXXX</code> functions are not obvious, and the consumers of the package would either have to search them in the package documentation or depend on their IDE autocomplete to show them the possible options.</p><p>In my opinion, it does not give you any benefits over the <code>Options</code> struct, but bring the downside that the options are not obvious.</p><h3 id=middle-ground>Middle ground</h3><p>A middle ground between constructor with required positional arguments and optional arguments would be to have the required fields for a given struct as positional arguments so that the consumer MUST pass them, and have everything else as optional parameters, which may be skipped.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>NewPerson</span>(name <span style=color:#dc322f>string</span>, options <span style=color:#719e07>*</span>PersonOptions) <span style=color:#719e07>*</span>Person {
</span></span><span style=display:flex><span>  p <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Person{name: name}
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> options <span style=color:#719e07>==</span> <span style=color:#cb4b16>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> p
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> options.Age <span style=color:#719e07>!=</span> <span style=color:#2aa198>0</span> <span style=color:#586e75>/* OR options.Age != nil */</span> {
</span></span><span style=display:flex><span>    p.age = options.Age <span style=color:#586e75>/* OR p.age = *options.Age */</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> options.Salary <span style=color:#719e07>!=</span> <span style=color:#2aa198>0</span> <span style=color:#586e75>/* OR options.Salary != nil */</span>  {
</span></span><span style=display:flex><span>    p.salary = options.Salary <span style=color:#586e75>/* OR p.salary = *options.Salary */</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> p
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// usage:
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>p <span style=color:#719e07>:=</span> <span style=color:#268bd2>NewPerson</span>(<span style=color:#2aa198>&#34;Anton&#34;</span>, <span style=color:#719e07>&amp;</span>people.PersonOptions{Age: <span style=color:#2aa198>25</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fmt.<span style=color:#268bd2>Println</span>(p) <span style=color:#586e75>// {name: &#34;Anton&#34;, age: 25}
</span></span></span></code></pre></div><h2 id=summary>Summary</h2><p>There are 2 build-in ways to initialize a Go struct.
Both are quite limited and more often than not they are not enough.
That is why people came up with more sophisticated solutions (based on the built-in ones).</p><h2 id=takeaways>Takeaways</h2><p>So what is the best option?
Well, there isn’t one.
All described approaches have their pros and cons.
They depend on your use case and the way your code is meant to be used.
As with everything in computer science, there is not a single correct solution or a silver bullet.
It’s all a matter of the tradeoffs you are willing to make.</p><p>If you are writing a library that will be used by hundreds of other projects, backwards-incompatible changes will not be appreciated by your consumers, so you need to choose the more flexible options.
If you’re working locally in a single codebase, signature changes can be beneficial, because they will enforce that all usages of the methods are adapted.</p><p>If you got to the end of the article, I just want you to know that I recently started this blog,
and this is the first article in it.
If it was useful for you, you learned something new, or you think it can be improved feel free to ping me on <a href=https://twitter.com/a_sankov>Twitter</a>, <a href=https://linkedin.com/in/asankov>LinkedIn</a> or <a href=mailto:asankov96+initgo@gmail.com>email</a>.
I would appreciate the feedback.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=me-1>←</span>Previous</a></li><li><a href=/blog/2022/04/21/securing-kubernetes-with-open-policy-agent/ aria-label="Next - Securing Kubernetes with Open Policy Agent" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=mailto:asankov96@gmail.com aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Bluesky aria-label=Bluesky><a target=_blank rel=noopener href=https://bsky.app/profile/asankov.dev aria-label=Bluesky><i class="fa-brands fa-bluesky"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Threads aria-label=Threads><a target=_blank rel=noopener href=https://www.threads.net/@a.sankov aria-label=Threads><i class="fa-brands fa-threads"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/asankov aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://linkedin.com/in/asankov aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>Anton Sankov</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span><p class="td-footer__about mt-2"><a href=/about/>About Me</a></p></div></div></div></footer></div><script src=/js/main.min.825a08a36a50b712e046faa3779bee6ed314acb043ad1d5a09314e713af5cf6e.js integrity="sha256-gloIo2pQtxLgRvqjd5vubtMUrLBDrR1aCTFOcTr1z24=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>